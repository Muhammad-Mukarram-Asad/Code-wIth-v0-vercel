<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Team Connect Memory Game</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @keyframes flipCard {
      0% { transform: rotateY(0deg); }
      100% { transform: rotateY(180deg); }
    }
    
    @keyframes flipCardBack {
      0% { transform: rotateY(180deg); }
      100% { transform: rotateY(0deg); }
    }
    
    @keyframes matchSuccess {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .card-flip {
      animation: flipCard 0.4s forwards;
    }
    
    .card-flip-back {
      animation: flipCardBack 0.4s forwards;
    }
    
    .card-match {
      animation: matchSuccess 0.5s ease-in-out;
    }
    
    .modal-backdrop {
      background-color: rgba(0, 0, 0, 0.5);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app-container" class="h-full w-full overflow-auto"><!-- Start Screen -->
   <div id="start-screen" class="min-h-full flex items-center justify-center p-6">
    <div class="text-center max-w-2xl">
     <h1 id="game-title" class="mb-4 font-bold">Team Connect</h1>
     <p id="subtitle" class="mb-8">Match emoji pairs to unlock conversation starters and get to know your team!</p><button id="start-button" class="px-8 py-4 rounded-lg font-semibold transition-all duration-200 hover:scale-105"> Start Game </button>
    </div>
   </div><!-- Game Screen -->
   <div id="game-screen" class="min-h-full p-6 hidden">
    <div class="max-w-6xl mx-auto"><!-- Game Header -->
     <div class="mb-6">
      <div class="flex justify-between items-center mb-4">
       <h2 id="game-screen-title" class="font-bold">Team Connect</h2><button id="new-game-button" class="px-4 py-2 rounded-lg font-medium transition-all duration-200"> New Game </button>
      </div>
      <div class="flex gap-4">
       <div class="px-4 py-2 rounded-lg"><span class="font-semibold">Matches: </span> <span id="matches-count">0</span>/<span id="total-pairs">6</span>
       </div>
       <div class="px-4 py-2 rounded-lg"><span class="font-semibold">Moves: </span> <span id="moves-count">0</span>
       </div>
      </div>
     </div><!-- Game Grid -->
     <div id="game-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-4 gap-4 mb-6"><!-- Cards will be inserted here -->
     </div><!-- Conversation Starters -->
     <div id="conversation-section" class="mt-8 hidden">
      <h3 id="conversation-title" class="mb-4 font-bold">Conversation Starter</h3>
      <div id="conversation-card" class="p-6 rounded-lg shadow-lg">
       <p id="conversation-text" class="text-lg"></p>
      </div>
     </div>
    </div>
   </div><!-- Victory Modal -->
   <div id="victory-modal" class="fixed inset-0 flex items-center justify-center p-6 hidden modal-backdrop">
    <div class="max-w-md w-full p-8 rounded-2xl shadow-2xl text-center">
     <div class="text-6xl mb-4">
      ðŸŽ‰
     </div>
     <h3 id="victory-title" class="mb-2 font-bold">Congratulations!</h3>
     <p id="victory-message" class="mb-6">You completed the game!</p><button id="play-again-button" class="px-8 py-3 rounded-lg font-semibold transition-all duration-200"> Play Again </button>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      background_color: "#f0f4ff",
      card_back_color: "#6366f1",
      card_front_color: "#ffffff",
      text_color: "#1e293b",
      primary_button_color: "#6366f1",
      game_title: "Team Connect",
      subtitle: "Match emoji pairs to unlock conversation starters and get to know your team!",
      start_button_text: "Start Game",
      new_game_button_text: "New Game",
      font_family: "system-ui",
      font_size: 16
    };

    const emojis = ["ðŸ’¼", "â˜•", "ðŸ’¡", "ðŸŽ¯", "ðŸš€", "ðŸŒŸ"];
    
    const questions = [
      "What emoji best describes your morning?",
      "What's your go-to productivity hack?",
      "If you could master any skill instantly, what would it be?",
      "What's a work skill you're proud of developing?",
      "What's your favorite way to take a break during work?",
      "What's one thing on your desk that makes you smile?",
      "What's a recent win you'd like to celebrate?",
      "If your job was a movie genre, what would it be?",
      "What's the best advice you've received in your career?",
      "What's something new you'd like to try at work?"
    ];

    let gameState = {
      cards: [],
      flippedCards: [],
      matchedPairs: 0,
      moves: 0,
      isProcessing: false,
      currentQuestion: null
    };

    function initGame() {
      const shuffledEmojis = [...emojis, ...emojis].sort(() => Math.random() - 0.5);
      gameState.cards = shuffledEmojis.map((emoji, index) => ({
        id: index,
        emoji: emoji,
        isFlipped: false,
        isMatched: false
      }));
      gameState.flippedCards = [];
      gameState.matchedPairs = 0;
      gameState.moves = 0;
      gameState.isProcessing = false;
      gameState.currentQuestion = null;
      
      renderGame();
      document.getElementById('conversation-section').classList.add('hidden');
    }

    function renderGame() {
      const grid = document.getElementById('game-grid');
      grid.innerHTML = '';
      
      gameState.cards.forEach(card => {
        const cardEl = document.createElement('div');
        cardEl.className = 'aspect-square rounded-xl cursor-pointer transition-all duration-200 hover:scale-105 flex items-center justify-center text-5xl font-bold shadow-lg';
        cardEl.style.backgroundColor = card.isFlipped || card.isMatched ? window.elementSdk.config.card_front_color : window.elementSdk.config.card_back_color;
        cardEl.style.color = window.elementSdk.config.text_color;
        cardEl.textContent = card.isFlipped || card.isMatched ? card.emoji : '?';
        
        if (!card.isMatched) {
          cardEl.addEventListener('click', () => handleCardClick(card.id));
        }
        
        grid.appendChild(cardEl);
      });
      
      document.getElementById('matches-count').textContent = gameState.matchedPairs;
      document.getElementById('moves-count').textContent = gameState.moves;
    }

    function handleCardClick(cardId) {
      if (gameState.isProcessing) return;
      
      const card = gameState.cards.find(c => c.id === cardId);
      if (card.isFlipped || card.isMatched) return;
      if (gameState.flippedCards.length >= 2) return;
      
      card.isFlipped = true;
      gameState.flippedCards.push(cardId);
      renderGame();
      
      if (gameState.flippedCards.length === 2) {
        gameState.moves++;
        gameState.isProcessing = true;
        checkMatch();
      }
    }

    function checkMatch() {
      const [id1, id2] = gameState.flippedCards;
      const card1 = gameState.cards.find(c => c.id === id1);
      const card2 = gameState.cards.find(c => c.id === id2);
      
      if (card1.emoji === card2.emoji) {
        card1.isMatched = true;
        card2.isMatched = true;
        gameState.matchedPairs++;
        gameState.flippedCards = [];
        gameState.isProcessing = false;
        
        showConversationStarter();
        renderGame();
        
        if (gameState.matchedPairs === emojis.length) {
          setTimeout(showVictory, 500);
        }
      } else {
        setTimeout(() => {
          card1.isFlipped = false;
          card2.isFlipped = false;
          gameState.flippedCards = [];
          gameState.isProcessing = false;
          renderGame();
        }, 1000);
      }
    }

    function showConversationStarter() {
      const unusedQuestions = questions.filter(q => q !== gameState.currentQuestion);
      if (unusedQuestions.length === 0) {
        gameState.currentQuestion = questions[Math.floor(Math.random() * questions.length)];
      } else {
        gameState.currentQuestion = unusedQuestions[Math.floor(Math.random() * unusedQuestions.length)];
      }
      
      document.getElementById('conversation-text').textContent = gameState.currentQuestion;
      document.getElementById('conversation-section').classList.remove('hidden');
    }

    function showVictory() {
      const victoryMessage = document.getElementById('victory-message');
      victoryMessage.textContent = `You completed the game in ${gameState.moves} moves!`;
      document.getElementById('victory-modal').classList.remove('hidden');
    }

    function startGame() {
      document.getElementById('start-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('hidden');
      initGame();
    }

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      const appContainer = document.getElementById('app-container');
      appContainer.style.backgroundColor = config.background_color || defaultConfig.background_color;
      appContainer.style.fontFamily = `${customFont}, ${baseFontStack}`;
      
      const gameTitle = document.getElementById('game-title');
      gameTitle.textContent = config.game_title || defaultConfig.game_title;
      gameTitle.style.fontSize = `${baseSize * 2.5}px`;
      gameTitle.style.color = config.text_color || defaultConfig.text_color;
      
      const subtitle = document.getElementById('subtitle');
      subtitle.textContent = config.subtitle || defaultConfig.subtitle;
      subtitle.style.fontSize = `${baseSize * 1.125}px`;
      subtitle.style.color = config.text_color || defaultConfig.text_color;
      
      const startButton = document.getElementById('start-button');
      startButton.textContent = config.start_button_text || defaultConfig.start_button_text;
      startButton.style.backgroundColor = config.primary_button_color || defaultConfig.primary_button_color;
      startButton.style.color = config.card_front_color || defaultConfig.card_front_color;
      startButton.style.fontSize = `${baseSize * 1.125}px`;
      
      const gameScreenTitle = document.getElementById('game-screen-title');
      gameScreenTitle.textContent = config.game_title || defaultConfig.game_title;
      gameScreenTitle.style.fontSize = `${baseSize * 1.875}px`;
      gameScreenTitle.style.color = config.text_color || defaultConfig.text_color;
      
      const newGameButton = document.getElementById('new-game-button');
      newGameButton.textContent = config.new_game_button_text || defaultConfig.new_game_button_text;
      newGameButton.style.backgroundColor = config.primary_button_color || defaultConfig.primary_button_color;
      newGameButton.style.color = config.card_front_color || defaultConfig.card_front_color;
      newGameButton.style.fontSize = `${baseSize}px`;
      
      const statElements = document.querySelectorAll('#game-screen > div > div > div > div');
      statElements.forEach(el => {
        el.style.backgroundColor = config.card_front_color || defaultConfig.card_front_color;
        el.style.color = config.text_color || defaultConfig.text_color;
        el.style.fontSize = `${baseSize}px`;
      });
      
      const conversationTitle = document.getElementById('conversation-title');
      conversationTitle.style.fontSize = `${baseSize * 1.5}px`;
      conversationTitle.style.color = config.text_color || defaultConfig.text_color;
      
      const conversationCard = document.getElementById('conversation-card');
      conversationCard.style.backgroundColor = config.card_front_color || defaultConfig.card_front_color;
      
      const conversationText = document.getElementById('conversation-text');
      conversationText.style.fontSize = `${baseSize * 1.125}px`;
      conversationText.style.color = config.text_color || defaultConfig.text_color;
      
      const victoryModalContent = document.querySelector('#victory-modal > div');
      victoryModalContent.style.backgroundColor = config.card_front_color || defaultConfig.card_front_color;
      
      const victoryTitle = document.getElementById('victory-title');
      victoryTitle.style.fontSize = `${baseSize * 1.875}px`;
      victoryTitle.style.color = config.text_color || defaultConfig.text_color;
      
      const victoryMessage = document.getElementById('victory-message');
      victoryMessage.style.fontSize = `${baseSize * 1.125}px`;
      victoryMessage.style.color = config.text_color || defaultConfig.text_color;
      
      const playAgainButton = document.getElementById('play-again-button');
      playAgainButton.style.backgroundColor = config.primary_button_color || defaultConfig.primary_button_color;
      playAgainButton.style.color = config.card_front_color || defaultConfig.card_front_color;
      playAgainButton.style.fontSize = `${baseSize * 1.125}px`;
      
      renderGame();
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.card_front_color || defaultConfig.card_front_color,
              set: (value) => {
                config.card_front_color = value;
                window.elementSdk.setConfig({ card_front_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_button_color || defaultConfig.primary_button_color,
              set: (value) => {
                config.primary_button_color = value;
                window.elementSdk.setConfig({ primary_button_color: value });
              }
            },
            {
              get: () => config.card_back_color || defaultConfig.card_back_color,
              set: (value) => {
                config.card_back_color = value;
                window.elementSdk.setConfig({ card_back_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["subtitle", config.subtitle || defaultConfig.subtitle],
          ["start_button_text", config.start_button_text || defaultConfig.start_button_text],
          ["new_game_button_text", config.new_game_button_text || defaultConfig.new_game_button_text]
        ])
      });
    }

    document.getElementById('start-button').addEventListener('click', startGame);
    document.getElementById('new-game-button').addEventListener('click', initGame);
    document.getElementById('play-again-button').addEventListener('click', () => {
      document.getElementById('victory-modal').classList.add('hidden');
      initGame();
    });
  </script>
</html>
